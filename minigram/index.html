<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>MiniGram</title>
<style>
body {margin:0;font-family:Arial,sans-serif;background:#f0f2f5;}
#solMenu {position:fixed;top:0;left:0;width:150px;height:100%;background:#242526;color:white;display:flex;flex-direction:column;padding-top:20px;}
#solMenu button {margin:10px;padding:10px;border:none;border-radius:8px;background:#3a3b3c;color:white;cursor:pointer;text-align:left;transition:0.2s;}
#solMenu button:hover{background:#4e4f50;}
#ustBar {position:fixed;top:0;left:160px;right:0;height:50px;background:#4267B2;display:flex;align-items:center;padding:0 20px;color:white;font-size:20px;font-weight:bold;}
#arkadasAra input {padding:5px;width:150px;}
#arkadasAra button {padding:5px 10px;margin-left:5px;}
#icerik {margin-left:170px;margin-top:60px;padding:20px;}
.form-container{display:none;}
input,textarea{margin:5px 0;padding:5px;font-size:14px;}
.submit-btn{padding:5px 10px;background:#42b72a;border:none;border-radius:5px;color:white;cursor:pointer;}
.submit-btn:hover{background:#36a420;}
#profil img{width:100px;height:100px;border-radius:50%;}
#sohbetArea{width:100%;max-width:400px;height:200px;border:1px solid #ccc;overflow-y:auto;background:white;padding:5px;margin-bottom:5px;}
#arkadasListesi li{margin-bottom:10px;padding:5px;background:white;border-radius:5px;}
#anasayfa,#profil,#sohbet,#arkadaslar,#gonderiler{background:white;padding:15px;border-radius:10px;margin-bottom:20px;}
#gonderiAlani p{border-bottom:1px solid #ccc;padding:5px;}
.oy-btn{padding:2px 5px;margin-right:5px;cursor:pointer;border:none;border-radius:3px;}
.oy-btn:hover{opacity:0.7;}
</style>
</head>
<body>

<div id="solMenu">
    <button onclick="gosterAnasayfa()">Anasayfa</button>
    <button onclick="gosterProfil()">Profil</button>
    <button onclick="gosterGonderiler()">Gönderiler</button>
    <button onclick="gosterSohbet()">Sohbet</button>
    <button onclick="gosterArkadaslar()">Arkadaşlar</button>
</div>

<div id="ustBar">
    MiniGram
    <div id="arkadasAra" style="margin-left:auto;">
        <input type="text" id="araKullanici" placeholder="Kullanıcı Ara">
        <button onclick="araArkadasGelismis()">Ara</button>
        <div id="ustButonlar"></div>
    </div>
</div>

<div id="icerik">

<div id="anasayfa" class="form-container">
    <h2>MiniGram Anasayfa</h2>
    <p>Burada tüm paylaşımlar gösterilecek.</p>
    <div id="anasayfaGonderi"></div>
</div>

<div id="gonderiler" class="form-container">
    <h2>Gönderiler</h2>
    <textarea id="gonderiMetni" placeholder="Gönderi yaz..." rows="3" cols="40"></textarea><br>
    <button class="submit-btn" onclick="gonderiPaylas()">Paylaş</button>
    <h3>Paylaşımlar</h3>
    <div id="gonderiAlani"></div>
</div>

<div id="profil" class="form-container">
    <h2>Profil</h2>
    <div id="profilBilgi">
        <img id="profilFoto" src="https://via.placeholder.com/100" alt="Profil Fotoğrafı"><br>
        <input type="file" id="fotoInput" onchange="fotoYukle(event)"><br>
        <strong id="kullaniciAdiGoster"></strong><br>
        <span id="profilYazi"></span><br>
        <span>Takipçi: <span id="takipciSayisi">0</span></span><br>
        <span>Takip Edilen: <span id="takipEdilenSayisi">0</span></span>
    </div>
</div>

<div id="sohbet" class="form-container">
    <h2>Sohbet</h2>
    <h3 id="sohbetKisi">Arkadaş Seçiniz</h3>
    <div id="sohbetArea"></div>
    <input type="text" id="sohbetMesaj" placeholder="Mesajınızı yazın">
    <button class="submit-btn" onclick="gonder()">Gönder</button>
</div>

<div id="arkadaslar" class="form-container">
    <h2>Arkadaşlar</h2>
    <ul id="arkadasListesi"></ul>
</div>

<div id="girisForm" class="form-container">
    <h2>Giriş Yap</h2>
    <input type="text" id="user" placeholder="Kullanıcı Adı"><br>
    <input type="password" id="pass" placeholder="Şifre"><br>
    <button class="submit-btn" onclick="giris()">Giriş</button>
    <p id="mesaj"></p>
</div>

<div id="kayitForm" class="form-container">
    <h2>Kayıt Ol</h2>
    <input type="text" id="newUser" placeholder="Kullanıcı Adı"><br>
    <input type="password" id="newPass" placeholder="Şifre"><br>
    <input type="text" id="newProfText" placeholder="Kısa Profil Yazısı"><br>
    <button class="submit-btn" onclick="kayit()">Kayıt Ol</button>
    <p id="mesajKayit"></p>
</div>

</div>

<script>
// Kullanıcı verileri
let kullaniciAdi="", sifre="", profilYazi="", profilFotoURL="";
let tumKullanicilar = JSON.parse(localStorage.getItem("tumKullanicilar") || "[]");
let takipListesi = JSON.parse(localStorage.getItem("takipListesi") || "{}");
let gonderiler = JSON.parse(localStorage.getItem("gonderiler") || "[]");

// Üst butonları güncelle
function guncelleUstButon(){
    let ust = document.getElementById("ustButonlar");
    ust.innerHTML = "";
    if(localStorage.getItem("currentUser")){
        ust.innerHTML = `<button onclick="gosterProfil()">Profil Değiştir</button>`;
    } else {
        ust.innerHTML = `<button onclick="gosterGiris()">Giriş</button> <button onclick="gosterKayit()">Kayıt Ol</button>`;
    }
}

// Başlangıç
guncelleUstButon();
if(localStorage.getItem("currentUser")){
    kullaniciAdi = localStorage.getItem("currentUser");
    let userData = JSON.parse(localStorage.getItem(kullaniciAdi));
    sifre = userData.sifre;
    profilYazi = userData.profilYazi;
    profilFotoURL = userData.profilFotoURL || "https://via.placeholder.com/100";
    document.getElementById("profilFoto").src = profilFotoURL;
    document.getElementById("kullaniciAdiGoster").innerText = kullaniciAdi;
    document.getElementById("profilYazi").innerText = profilYazi;
    gosterAnasayfa();
}else{
    gosterKayit();
}

// Göster/gizle
function gizleTum(){["anasayfa","profil","sohbet","arkadaslar","gonderiler","girisForm","kayitForm"].forEach(id=>document.getElementById(id).style.display="none");}
function gosterAnasayfa(){gizleTum(); document.getElementById("anasayfa").style.display="block"; guncelleGonderiler(); guncelleGonderiAnasayfa();}
function gosterProfil(){gizleTum(); document.getElementById("profil").style.display="block"; guncelleProfil();}
function gosterSohbet(){gizleTum(); document.getElementById("sohbet").style.display="block";}
function gosterArkadaslar(){gizleTum(); document.getElementById("arkadaslar").style.display="block"; guncelleArkadasListesi();}
function gosterGonderiler(){gizleTum(); document.getElementById("gonderiler").style.display="block"; guncelleGonderiler();}
function gosterKayit(){gizleTum(); document.getElementById("kayitForm").style.display="block";}
function gosterGiris(){gizleTum(); document.getElementById("girisForm").style.display="block";}

// Fotoğraf yükle
function fotoYukle(e){
    let reader = new FileReader();
    reader.onload = function(){profilFotoURL = reader.result; document.getElementById("profilFoto").src = profilFotoURL; kaydetKullaniciVerisi();}
    reader.readAsDataURL(e.target.files[0]);
}

// Kayıt
function kayit(){
    kullaniciAdi = document.getElementById("newUser").value.trim();
    sifre = document.getElementById("newPass").value;
    profilYazi = document.getElementById("newProfText").value;
    if(kullaniciAdi===""||sifre===""){document.getElementById("mesajKayit").innerText="Tüm alanları doldurun!"; return;}
    if(tumKullanicilar.includes(kullaniciAdi)){document.getElementById("mesajKayit").innerText="Bu kullanıcı adı zaten var!"; return;}
    tumKullanicilar.push(kullaniciAdi);
    takipListesi[kullaniciAdi]=[];
    localStorage.setItem("tumKullanicilar", JSON.stringify(tumKullanicilar));
    localStorage.setItem("takipListesi", JSON.stringify(takipListesi));
    profilFotoURL = "https://via.placeholder.com/100";
    kaydetKullaniciVerisi();
    localStorage.setItem("currentUser", kullaniciAdi);
    guncelleUstButon();
    document.getElementById("kullaniciAdiGoster").innerText = kullaniciAdi;
    document.getElementById("profilYazi").innerText = profilYazi;
    document.getElementById("profilFoto").src = profilFotoURL;
    gosterAnasayfa();
}

// Giriş
function giris(){
    let u = document.getElementById("user").value.trim();
    let p = document.getElementById("pass").value;
    if(u === kullaniciAdi && p === sifre){
        localStorage.setItem("currentUser", kullaniciAdi);
        guncelleUstButon();
        document.getElementById("kullaniciAdiGoster").innerText = kullaniciAdi;
        document.getElementById("profilYazi").innerText = profilYazi;
        document.getElementById("profilFoto").src = profilFotoURL;
        gosterAnasayfa();
    } else {document.getElementById("mesaj").innerText = "Hatalı kullanıcı veya şifre!";}
}

// Kullanıcı kaydet
function kaydetKullaniciVerisi(){
    localStorage.setItem(kullaniciAdi, JSON.stringify({sifre,profilYazi,profilFotoURL}));
}

// Arkadaşlar
function guncelleArkadasListesi(){
    let liste=document.getElementById("arkadasListesi"); liste.innerHTML="";
    tumKullanicilar.forEach(u=>{
        if(u!==kullaniciAdi){
            let userData = JSON.parse(localStorage.getItem(u) || '{}');
            let profilFoto = userData.profilFotoURL || "https://via.placeholder.com/50";
            let profilYazi = userData.profilYazi || "";
            let takipDurum = takipListesi[kullaniciAdi].includes(u) ? "Takipten Çık" : "Takip Et";
            liste.innerHTML+=`
            <li style="display:flex; align-items:center; gap:10px; padding:5px; border:1px solid #ccc; border-radius:5px; margin-bottom:5px;">
                <img src="${profilFoto}" width="50" height="50" style="border-radius:50%;">
                <div style="flex-grow:1;">
                    <strong>${u}</strong><br>
                    <span>${profilYazi}</span><br>
                    <span>Takipçi: ${kacTakipci(u)}</span>
                </div>
                <div style="display:flex; flex-direction:column; gap:5px;">
                    <button onclick="takipEt('${u}')">${takipDurum}</button>
                    <button onclick="mesajGonder('${u}')">Sohbet</button>
                </div>
            </li>`;
        }
    });
    guncelleProfil();
}

function takipEt(kisi){
    if(takipListesi[kullaniciAdi].includes(kisi)){takipListesi[kullaniciAdi]=takipListesi[kullaniciAdi].filter(a=>a!==kisi);}
    else{takipListesi[kullaniciAdi].push(kisi);}
    localStorage.setItem("takipListesi",JSON.stringify(takipListesi));
    guncelleArkadasListesi();
}

function kacTakipci(kisi){
    let sayi=0; for(let k in takipListesi){if(takipListesi[k].includes(kisi)) sayi++;}
    return sayi;
}

function guncelleProfil(){
    document.getElementById("takipciSayisi").innerText=kacTakipci(kullaniciAdi);
    document.getElementById("takipEdilenSayisi").innerText=takipListesi[kullaniciAdi].length;
}

// Sohbet
function gonder(){
    let m=document.getElementById("sohbetMesaj").value.trim();
    let hedef=document.getElementById("sohbetKisi").innerText;
    if(m!==""){
        if(takipListesi[kullaniciAdi].includes(hedef)){
            let area=document.getElementById("sohbetArea");
            area.innerHTML+=`<b>${kullaniciAdi} -> ${hedef}:</b> ${m}<br>`;
            document.getElementById("sohbetMesaj").value="";
            area.scrollTop=area.scrollHeight;
        } else { alert("Sadece takip ettiğiniz kişilerle sohbet edebilirsiniz!"); }
    }
}

function mesajGonder(kisi){
    if(!takipListesi[kullaniciAdi].includes(kisi)){alert(`${kisi} senin takip ettiğin biri değil!`); return;}
    gosterSohbet();
    document.getElementById("sohbetKisi").innerText=kisi;
    document.getElementById("sohbetArea").innerHTML="";
}

// Gönderi paylaşma (like, dislike, yorum)
function gonderiPaylas(){
    let m = document.getElementById("gonderiMetni").value.trim();
    if(m==="") return;
    gonderiler.push({kullanici:kullaniciAdi,text:m,likes:0,dislikes:0,comments:[]});
    localStorage.setItem("gonderiler",JSON.stringify(gonderiler));
    document.getElementById("gonderiMetni").value="";
    guncelleGonderiler(); guncelleGonderiAnasayfa();
}

function guncelleGonderiler(){
    let area=document.getElementById("gonderiAlani");
    area.innerHTML="";
    gonderiler.slice().reverse().forEach((g,i)=>{
        area.innerHTML+=`<p><b>${g.kullanici}:</b> ${g.text} 
        <button class="oy-btn" onclick="like(${i})">👍 ${g.likes}</button>
        <button class="oy-btn" onclick="dislike(${i})">👎 ${g.dislikes}</button>
        <button class="oy-btn" onclick="yorumEkle(${i})">💬 Yorum</button>
        </p>`;
        g.comments.forEach(c=>{area.innerHTML+=`<p style="margin-left:20px;">${c}</p>`});
    });
}

function guncelleGonderiAnasayfa(){
    let area=document.getElementById("anasayfaGonderi");
    area.innerHTML="";
    gonderiler.slice().reverse().forEach((g,i)=>{
        area.innerHTML+=`<p><b>${g.kullanici}:</b> ${g.text} 
        <button class="oy-btn" onclick="like(${i})">👍 ${g.likes}</button>
        <button class="oy-btn" onclick="dislike(${i})">👎 ${g.dislikes}</button>
        <button class="oy-btn" onclick="yorumEkle(${i})">💬 Yorum</button>
        </p>`;
        g.comments.forEach(c=>{area.innerHTML+=`<p style="margin-left:20px;">${c}</p>`});
    });
}

function like(i){gonderiler[i].likes++; kaydetGonderiler();}
function dislike(i){gonderiler[i].dislikes++; kaydetGonderiler();}
function yorumEkle(i){
    let y=prompt("Yorumunuzu yazın:");
    if(y){gonderiler[i].comments.push(`${kullaniciAdi}: ${y}`); kaydetGonderiler();}
}
function kaydetGonderiler(){localStorage.setItem("gonderiler",JSON.stringify(gonderiler)); guncelleGonderiler(); guncelleGonderiAnasayfa();}

// Arkadaş arama geliştirilmiş
function araArkadasGelismis(){
    let ara = document.getElementById("araKullanici").value.trim().toLowerCase();
    let liste = document.getElementById("arkadasListesi"); liste.innerHTML="";
    if(ara==="") return;
    tumKullanicilar.forEach(u=>{
        if(u.toLowerCase().includes(ara) && u!==kullaniciAdi){
            let userData = JSON.parse(localStorage.getItem(u) || '{}');
            let profilFoto = userData.profilFotoURL || "https://via.placeholder.com/50";
            let profilYazi = userData.profilYazi || "";
            let takipDurum = takipListesi[kullaniciAdi].includes(u) ? "Takipten Çık" : "Takip Et";
            liste.innerHTML += `
            <li style="display:flex; align-items:center; gap:10px; padding:5px; border:1px solid #ccc; border-radius:5px; margin-bottom:5px;">
                <img src="${profilFoto}" width="50" height="50" style="border-radius:50%;">
                <div style="flex-grow:1;">
                    <strong>${u}</strong><br>
                    <span>${profilYazi}</span><br>
                    <span>Takipçi: ${kacTakipci(u)}</span>
                </div>
                <div style="display:flex; flex-direction:column; gap:5px;">
                    <button onclick="takipEt('${u}')">${takipDurum}</button>
                    <button onclick="mesajGonder('${u}')">Sohbet</button>
                </div>
            </li>`;
        }
    });
}
</script>

</body>
</html>
